<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
    <style>
        .item-div {
            background: pink;
        }

        .item-header {
            background: tomato;
        }

        footer {
            height: 30vh;
        }

        body {
            margin: 0 auto;
            padding: 1rem;
            max-width: 640px;
        }

        /* body,
        input,
        textarea {
            background: #e7e5e4;
        } */
    </style>
</head>

<body>
    <script src="https://unpkg.com/@webcomponents/webcomponentsjs@2.3.0/webcomponents-loader.js"></script>
    <script src="../../dist/browser.js"></script>
    <script>
        const {
            reactive,
            computed,
            difineDirective,
            Store,
            ViewModel,
            h
        } = Poi;
    </script>
    <!--  -->
    <div id="appRoot"></div>
    <script>
        class app extends Poi {
            setup() {
                const info = reactive({
                    msg: "Poi Component",
                    count: 0,
                    computedCallCount: 0,
                    now: new Date().toLocaleString(),
                })
                return {
                    info,
                    double: computed(() => {
                        info.computedCallCount++
                        return info.count * 2
                    })
                }
            }
            created() {
                setInterval(() => this.info.now = new Date().toLocaleString(), 1000)
            }
            template() {
                return h(
                    `
now: <span>{{ info.now }}</span>
<h1>{{ info.msg }}</h1>
<button @click="plusCount">+1</button>
<span &html="info.count"></span>
<span $if="info.count%2==0">is even number</span>
<br>
<!-- hello world -->
<button @click="whatDoubleCount" title="computed: double count">alert(double count)</button><span> computed called count:{{ info.computedCallCount }}</span><br>`
                )
            }
            plusCount() {
                this.info.count += 1
            }
            whatDoubleCount() {
                alert("this.double.value is " + this.double.value)
            }
            doubleCount() {
                return this.double.value
            }
        }
        Poi.createApp(new app()).mount(appRoot);
    </script>
    <div id="mvvm-app">
        <h1> mvvm </h1>
        <input _model="msg2">
        <input p-bind:value="'src/' + msg + '/' + msg2 ">
        <div p-bind:class="'item-'+style"> msg2 = {{ msg2 }}</div>
        <hr>
        <h1>html diff</h1>
        <textarea _model="html" cols="30" rows="10"></textarea>
        <div p-bind:html="html"></div>
        <hr>
        <h1> $global </h1>
        <span>$global.appState.welcome = {{ $global.appState.welcome }}</span>
        <hr>
        <h1 p-bind:style="'color:' + (loginState.onlogin == 'success' ? 'green' : 'red')">
            Store <span>[{{ loginState.onlogin }}]</span>
        </h1>
        <button :click="login">login</button>
        <span>name: {{ loginState.user.name }} age: {{ loginState.user.age }}</span>
        <hr>
        <h1> Next Tick </h1>
        <button :click="countUp">{{msg}}</button>
        <button :click="countUpx500">countUpx500</button>
        <hr>
        <h1> mark system: directive[for] </h1>
        <button :click="clearList">clear</button>
        <button :click="randAddItem">random add</button>
        <span>items.length: {{ items.length }}</span>
        <ul>
            <span>===mark start===</span>
            <li _for="item,i of items">
                <span>{{i}}: </span>
                {{item}}
                <span>{{count}}</span>
            </li>
            <span>===mark end===</span>
        </ul>
        <hr>
        <div _bg="#0e8dbc" style="text-align: center;padding: 1rem;">
            <h1 _f-w="100" _shadow>custom directive</h1>
        </div>
    </div>
    <script>
        difineDirective("f-w", function (node, vm, exp, args) {
            node.style.fontWeight = exp
        })
        difineDirective("bg", function (node, vm, exp, args) {
            node.style.background = exp
        })
        difineDirective("shadow", function (node, vm, exp, args) {
            node.style.color = "#fff"
            node.style.textShadow =
                "0 1px 0 #CCCCCC, 0 2px 0 #c9c9c9, 0 3px 0 #bbb, 0 4px 0 #b9b9b9, 0 5px 0 #aaa, 0 6px 1px rgba(0,0,0,.1), 0 0 5px rgba(0,0,0,.1), 0 1px 3px rgba(0,0,0,.3), 0 3px 5px rgba(0,0,0,.2), 0 5px 10px rgba(0,0,0,.25), 0 10px 10px rgba(0,0,0,.2), 0 20px 20px rgba(0,0,0,.15)"
        });;
    </script>
    <script>
        const $ = q => document.querySelector(q)

        const loginState = reactive({
            onlogin: "inited",
            user: {}
        })
        const loginStore = new Store(function setup() {
            return {
                loginSuccess() {
                    loginState.onlogin = "success"
                },
                loginFailed() {
                    loginState.onlogin = "failed"
                },
                setUser(user) {
                    loginState.user = user
                }
            }
        })

        let vm = new ViewModel(reactive({
            loginState,
            msg: "hello world",
            msg2: "",
            count: 0,
            style: 'div',
            items: [
                "apple",
                "banana",
            ],
            html: `<ul>
    <li>01</li>
    <li>02</li>
    <li>03</li>
    <li>04</li>
</ul>`,
            countUp() {
                this.msg = `hello world ${this.count++}`
            },
            countUpx500() {
                for (let i = 0; i < 100; i++) {
                    this.msg = `hello world ${this.count++}`
                    this.msg = `hello world ${this.count++}`
                    this.msg = `hello world ${this.count++}`
                    this.msg = `hello world ${this.count++}`
                    this.msg = `hello world ${this.count++}`
                }
            },
            clearList() {
                this.items = []
            },
            randAddItem() {
                this.items.push(Math.random() * Number.MAX_SAFE_INTEGER)
            },
            async login() {
                let user
                try {
                    user = await fetch("./user.json")
                } catch (error) {
                    console.warn(err)
                    loginStore.dispatch("loginFailed")
                    return
                }
                loginStore.dispatch("setUser", await user.json())
                loginStore.dispatch("loginSuccess")
            },
            init() {
                this.$global.appState = {
                    welcome: "hello world"
                }
            }
        }), {
            el: $("#mvvm-app")
        });
    </script>
    <hr>
    <h1>Component</h1>
    <div id="hoverCard" color="green">Component, go!</div>
    <script>
        class HoverCard extends Poi {
            template() {
                return h(`
                <style>
                .card{
                    margin: 1rem;
                    padding: .5rem 1rem;
                    border-radius: .5rem;
                    // border: 1px solid #007bff;
                    box-shadow: 0 3px 15px 3px #6c757d60;
                    text-align: center;
                }
                .card:hover{
                    box-shadow: 0 3px 15px 3px #6c757d;
                }
                </style>
                <div class="card" style:="'color:'+props.color"><slot></slot></div>
                `)
            }
            props() {
                return {
                    "color": {
                        type: String,
                        default: "#007bff"
                    }
                }
            }
        }
        Poi.createApp(new HoverCard()).mount(hoverCard)
        Poi.createApp(new HoverCard()).component("hover-card");
    </script>
    <div id="testApp1"></div>
    <script>
        class TestApp1 extends Poi {
            setup() {
                const font = reactive({
                    color: "#a4b"
                })
                return {
                    font
                }
            }
            template() {
                return h(`
                font.color: <input $model="font.color">
                <hover-card color:="font.color">
                    Passing Data to Child Components with Props!
                </hover-card>`)
            }
        }
        Poi.createApp(new TestApp1()).mount(testApp1);
    </script>
    <h1>Component Function bind</h1>
    <div id="testApp2"></div>
    <script>
        class callBcackComp extends Poi {
            template() {
                return h(`<button :click="props.callback">call <slot></slot></button>`)
            }
            props() {
                return {
                    "callback": {
                        type: Function,
                        default: () => console.log("default callback")
                    }
                }
            }
        }
        Poi.createApp(new callBcackComp()).component("call-back")
        class TestApp2 extends Poi {
            constructor() {
                super("test-app2")
            }
            setup() {
                return reactive({
                    text: "hello im test-app2"
                })
            }
            template() {
                return h(`
                <call-back>default</call-back>
                <call-back callback:="clear">clear</call-back>
                <br>
                message: <span html:="text"></span>`)
            }
            clear() {
                console.log("clear called")
                if (this.text == "") {
                    this.text = "hello im test-app2"
                } else {
                    this.text = ""
                }
            }
        }
        Poi.createApp(new TestApp2()).mount(testApp2);
    </script>
    <footer></footer>
</body>

</html>
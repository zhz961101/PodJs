<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
    <style>
        .item-div {
            background: pink;
        }

        .item-header {
            background: tomato;
        }

        /* body,
        input,
        textarea {
            background: #e7e5e4;
        } */
    </style>
</head>

<body>
    <script src="../dist/index.js"></script>
    <app-root></app-root>
    <script>
        class app extends Poi {
            constructor() {
                super("app-root")
            }
            setup() {
                const info = reactive({
                    msg: "Poi Component",
                    count: 0,
                    now: new Date().toLocaleString(),
                })
                return {
                    info,
                    double: computed(() => info.count * 2)
                }
            }
            created() {
                setInterval(() => this.info.now = new Date().toLocaleString(), 1000)
            }
            template() {
                return `
<h1>{{ info.msg }}<span> {{ info.count }} </span> </h1>
<button :click="whatDoubleCount" title="computed: double count">wdc</button>
<button :click="plusCount">+1</button>
now: <span> {{ info.now }} </span>`
            }
            plusCount() {
                this.info.count += 1
            }
            whatDoubleCount() {
                alert("this.double.value is " + this.double.value)
            }
            doubleCount() {
                return this.double.value
            }
        }
        new app();;
    </script>
    <div id="mvvm-app">
        <h1> mvvm </h1>
        <input _model="msg2">
        <input value:="'src/' + msg + '/' + msg2 ">
        <div class:="'item-'+style"> msg2 = {{ msg2 }}</div>
        <hr>
        <h1>html diff</h1>
        <textarea _model="html" cols="30" rows="10"></textarea>
        <div html:="html"></div>
        <hr>
        <h1> $global </h1>
        <span>$global.appState.welcome = {{ $global.appState.welcome }}</span>
        <hr>
        <h1 style:="'color:' + (loginState.onlogin == 'success' ? 'green' : 'red')">Store</h1><button
            :click="login">login</button>
        <span>name: {{ loginState.user.name }} age: {{ loginState.user.age }}</span>
        <hr>
        <h1> Next Tick </h1>
        <button :click="countUp">{{msg}}</button>
        <button :click="countUpx500">countUpx500</button>
        <hr>
        <h1> for array </h1>
        <button :click="randAddItem">random add</button>
        <span>items.length: {{ items.length }}</span>
        <ul>
            <li _for="item,i of items">
                <span>{{i}}: </span>
                {{item}}
                <span>{{count}}</span>
            </li>
        </ul>
        <hr>
        <div _bg:="#0e8dbc" style="text-align: center;padding: 1rem;">
            <h1 _f-w:="400" _shadow>custom directive</h1>
        </div>
    </div>
    <script>
        difineDirective("f-w", function (node, vm, exp, args) {
            node.style.fontWeight = exp
        })
        difineDirective("bg", function (node, vm, exp, args) {
            node.style.background = exp
        })
        difineDirective("shadow", function (node, vm, exp, args) {
            node.style.color = "#fff"
            node.style.textShadow =
                "0 1px 0 #CCCCCC, 0 2px 0 #c9c9c9, 0 3px 0 #bbb, 0 4px 0 #b9b9b9, 0 5px 0 #aaa, 0 6px 1px rgba(0,0,0,.1), 0 0 5px rgba(0,0,0,.1), 0 1px 3px rgba(0,0,0,.3), 0 3px 5px rgba(0,0,0,.2), 0 5px 10px rgba(0,0,0,.25), 0 10px 10px rgba(0,0,0,.2), 0 20px 20px rgba(0,0,0,.15)"
        });;
    </script>
    <script>
        const $ = q => document.querySelector(q)

        const loginState = reactive({
            onlogin: "inited",
            user: {}
        })
        const loginStore = new Store(function setup() {
            return {
                loginSuccess() {
                    loginState.onlogin = "success"
                },
                loginFailed() {
                    loginState.onlogin = "failed"
                },
                setUser(user) {
                    loginState.user = user
                }
            }
        })

        let vm = new ViewModel($("#mvvm-app"), reactive({
            loginState,
            msg: "hello world",
            msg2: "",
            count: 0,
            style: 'div',
            items: [
                "apple",
                "banana",
            ],
            html: `<ul>
    <li>01</li>
    <li>02</li>
    <li>03</li>
    <li>04</li>
</ul>`,
            countUp() {
                this.msg = `hello world ${this.count++}`
            },
            countUpx500() {
                for (let i = 0; i < 100; i++) {
                    this.msg = `hello world ${this.count++}`
                    this.msg = `hello world ${this.count++}`
                    this.msg = `hello world ${this.count++}`
                    this.msg = `hello world ${this.count++}`
                    this.msg = `hello world ${this.count++}`
                }
            },
            randAddItem() {
                this.items.push(Math.random() * Number.MAX_SAFE_INTEGER)
            },
            async login() {
                let user
                try {
                    user = await fetch("./user.json")
                } catch (error) {
                    console.warn(err)
                    loginStore.dispatch("loginFailed")
                    return
                }
                loginStore.dispatch("setUser", await user.json())
                loginStore.dispatch("loginSuccess")
            },
            init() {
                this.$global.appState = {
                    welcome: "hello world"
                }
            }
        }));
    </script>
</body>

</html>